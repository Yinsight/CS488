import java.util.*;

//CommandLine reference:
//https://commons.apache.org/proper/commons-cli/javadocs/api-1.3.1/org/apache/commons/cli/CommandLine.html

public class Iperfer {

    public static void main(String[] args) {
        CommandLine cmd = new CommandLine();
        //Set the flags with values to be tracked
        cmd.saveFlagValue("-h"); //host
        cmd.saveFlagValue("-p"); //port
        cmd.saveFlagValue("-t"); //time
        cmd.parse(args);
        
        //checker

        if (!cmd.hasFlag("-h") || !cmd.hasFlag("-p") || !cmd.hasFlag("-t") || cmd.numberOfFlags() > 3) {
            System.out.println("Error: missing or additional arguments");
            return;
        }

        int port = getInt(cmd.getFlagValue("-p"));

        if (port  < 1024 || port > 65535) {
            System.out.println("Error: port number must be in the range of 1024 to 65535");
            return;
        }

        String host = cmd.getFlagValue("-h");
        int timeinsec = getInt(cmd.getFlagValue("-t"));
    }

    //Convert string to int if valid
    private static int getInt(String portString) {
        try {
            return Integer.parseInt(portString);
        } catch (NumberFormatException e) {
            return 0;
        }
    }

    public static class CommandLine
    {
    	//Stores regular arguments (no flags)
        private String[] arguments = null;
        
        //Map keeps track of a flag and its value
        private Map<String, String> flags = new HashMap<>();
        
        //Set keeps track of flags which will have values
        private Set<String> flagsWithValues = new HashSet<>();

        public String[] getArguments() {
            return arguments;
        }
        
        //Returns value of a flag
        String getFlagValue(String flagName) {
            return flags.get(flagName);
        }
        
        //Returns total number of flags
        int numberOfFlags() {
            return flags.size();
        }
        
        //Check whether flag exists
        boolean hasFlag(String flagName) {
            return flags.containsKey(flagName);
        }

        //Function: takes an array of args and extract its contents
        //Separating the flags from regular arments
        void parse(String[] args) {
            List<String> regularArgs = new ArrayList<>();
            for (int n = 0; n < args.length; ++n) {
                if (args[n].charAt(0) == '-') {
                    String name = args[n];
                    String value = null;

                    // Check for flag in flagWithValues and get the next arg as the value if it exists
                    if (flagsWithValues.contains(args[n]) && n < args.length - 1) {
                        value = args[++n];
                    }
                    flags.put(name, value);
                } else {
                    regularArgs.add(args[n]);
                }
            }

            int size = regularArgs.size();
            arguments = regularArgs.toArray(new String[size]);
        }

        // Add flags which have values
        void saveFlagValue(String flagName) {
            flagsWithValues.add(flagName);
        }
    }
}
